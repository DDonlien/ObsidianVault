
**跃入迷城 - v0.0.6**

**✨WHAT'S NEW**

**🛠️技术@阿之@Decay**

**UI视觉与交互**

- ✨新增: 仓库页面GUI配置@Taobe
- ✨新增: TAB状态栏GUI配置@Taobe
- 按TAB无法关闭TAB选单，得按ESC，这很怪@阿之
- 武器有时候攻速/攻击力会增加（由于敏捷或者义体效果）但这些数值没有反映到DPS/APS上@阿之
- 在安全屋打开TAB，血条颜色和左下角不统一@阿之
- 布局微调（优化统一）@阿之
- ✨新增: 武器打印机GUI配置@Taobe
- 技能数值引用功能@Taobe
- 调整数值布局@阿之
- 调整“当前使用”的标识（玩家测试下来根本反应不过来）@阿之
- ✨新增: 义体/智脑打印机GUI配置@Taobe
- 特殊字段功能@Taobe
- 调整打印机GUI布局@Taobe
- ✨新增: 无人机GUI配置
- ✨新增: DEMO专用的使用教程
- ✨新增: 对话GUI配置
- 重（有立绘）
- 中（屏幕字幕）
- 轻（头顶字幕）
- ✨新增: 主菜单GUI配置
- ✨新增: 设置选单GUI配置

**AI**

- 🐛修复: AI索敌逛街问题@Taobe
- 我到现在都不知道为啥BTW；表征上，AI会前往索敌位置索敌，但会在那边疯狂转头（即使期间很明显视野已经看到了玩家）然后转个好几次才会正常进入看到玩家后的战斗流程；从BT来看我觉得打断逻辑是对的，soooo
- 在team修复后，这个问题似乎改善了，但还是偶尔会触发
- ✨新增: 广播衰减@Decay
- 让听力或者广播的距离，在隔墙的情况下距离减少50%
- 理想情况下，每多一面墙，多减少50%当前值，但这个不好搞的话倒也没啥，主要是能衰减
- 目前看受影响的应该是TEAM和SOUND，SIGHT、TOUCH、DAMAGE应该不影响
- 统一修改广播范围（因为TEAM没有RECEIVE范围）
- ✨新增: 移动增加声音广播@阿之@Taobe
- 用移速做一个公式，小于X不发声；X -> Y逐渐变大范围（我会配置Y对应的范围，X对应的就是0）然后CLAMP在对应的范围（以防玩家无限加速，然后声音范围无限大）；Y我会配置成默认的疾跑速度
- 这个X现在键盘感知不到，手柄可以，以及未来有蹲伏也可以
- ✨新增: 武器/技能增加声音广播@阿之@Taobe
- 近战武器：击中位置
- ~~远程武器：击发（玩家）位置~~
- 技能：击发或击中位置；如果是放置类技能，可能是在放置物所在位置，但这里变量特别多，所以有点难说（比如如果放的是无人机炮？）
- 爆炸物：爆炸位置；现在没有，以后会有手雷和火箭筒之类的，这些可能都要特殊处理，例如火箭筒会在发射（远程武器）和爆炸（爆炸物）位置都有；后者可能就只是爆炸位置（我本来还想做成每次弹墙都有，但有点复杂说实话）
- ✨新增: 翻滚增加声音广播@阿之@Taobe
- 以玩家为中心，整个翻滚期间都广播；义体把翻滚改成冲刺不会影响这个效果
- ✨新增: 新增从阳台/电梯补充敌人的功能@Decay
- 补充的敌人会获得全图的TEAM PERCEPTION HEARING（从而可以获得任意范围内最新的队友广播），直至第一次目击玩家恢复正常

**基础系统**

- 🐛修复: 使半墙在Playground内生效@Decay
- 🐛修复: 调整一下VFX的渲染逻辑
- 现在的vfx很容易看不清，改成dota2类似的模式@Decay

**战斗系统**

- 🪡修改: 调整冲击力系统（复杂了兄弟）@Decay
- 🗄️整理: 我们现在有这几个指标，我先标准化措辞（可能有修改，以这个为准）
- **角色：**韧性值 Poise / Float
- **武器/技能：**韧性伤害 PoiseDamage / Float
- **角色：**韧性等级 PoiseLevel / Int
- **武器/技能：**冲击等级 ImpactLevel / Int
- **武器/技能：**冲击类型 ImpactType / Int -> 这里有修改，本来是String
- **系统：**硬直事件 StunEvent / List -> 包含Index (Int，新增，不过本来默认也有)、动画 (Object)、时长 (Float)、最小时长 (Float，新增)、限制性 (Bool，有修改)
- StunType的List，关于限制性的内容需要统一命名，改为“阻止XX”这样的名称（现在有正有反），都是Bool
- 阻止蹲伏（现在没有，先不做）
- 阻止移动（修改，如果为true，给我一个FLOAT填写减速比例，0代表完全不能动；或者直接改为FLOAT我填1代表不减也可以）
- 阻止旋转（修改，如果为true，给我一个FLOAT填写减速比例，0代表完全不能转；或者直接改为FLOAT我填1代表不减也可以）
- 阻止换弹（新增）
- 阻止攻击（修改，本来是阻止动作）
- 阻止武器技能（修改，细分，可以先合并到阻止攻击，有必要再拆分）
- 阻止智脑技能（修改，细分，可以先合并到阻止攻击，有必要再拆分）
- 阻止翻滚（新增）
- ✨新增: 武器攻击、主动技能（武器、智脑）、翻滚、冲刺、~~蹲伏~~（所有行为）增加“临时韧性等级” (TemproPoiseLevel)值，在执行时临时增加韧性等级 PoiseLevel
- 这种“增加”不关乎该行为是否被StunEvent阻止，只关乎玩家本身（能量、体力、Debuff、Buff）是否能执行该行为，能就增加
- 🪡修改: 当角色受到攻击时，修改判定逻辑为如下：
- 判断伤害来源：if ( ImpactLevel > PoiseLevel )
- If No -> 无事发生；但受到=PoiseDamage的Poise伤害，Poise的自然恢复进入冷却
- If Yes -> 触发StunEvent，这里非常复杂
- X = RoundUp ( ImpactType \* ( ImpactLevel - PoiseLevel ) / ImpactLevel ) )
- 触发Index = X的StunEvent
- 举例：假设大锤的ImpactLevel = 3，ImpactType = 3（比如3是重硬直好了），攻击一个中甲（PoiseLevel = 2）敌人，此时会造成 RoundUp ( 3 \* ( 3 - 2 ) / 3) = 1的冲击效果（StunEventIndex = 1）
- 这样可以保证：玩家/敌人的韧性等级有持续的收益，而不是赢家通吃（只要高1点就完全白积攒）；我也可以很自由的做高破防低冲击的武器（比如ImpactLevel=99，ImpactType=1的破甲小刀）
- 如果玩家是在执行行为期间受到攻击，用PoiseLevel + TemproPoiseLevel判定
- ✨新增: 当角色已经进入StunEvent，此时如果尝试进行被判定打断的行动，则：
- 先计算最新的 PoiseLevelNew = PoiseLevel + TemproPoiseLevel，比如武器攻击时会由武器提供 +2 之类的
- 和触发当前Stun的攻击的ImpactLevel比较，If PoiseLevelNew > 先前触发本次StunEvent的ImpactLevel，解除硬直
- 解除硬直的行为只能发生在最小时长之后
- 是否不限制对应动作的情况下，也受到最小时长限制 -> 目前想，不受
- 是否要按第二次，还是自动触发，可能要想一下 -> 目前想，再按一次

**装备**

- 🐛修复: 近战武器有一些很诡异的攻击无效区域，比如我拿大锤、熔渣切断器之类的武器，在攻击时敌人如果贴脸我是造成不了伤害的，这个体验特别差，之前火焰喷射器也有这个问题@Decay
- 🪡修改: 居合斩没办法取消，打算改成切换模式：按下居合，再按攻击键释放/按技能键取消
- 然后这个碰撞现在无法穿过敌人，感觉是之前加了ENEMY TAG导致的@Decay
- 🐛修复:  火箭冲刺无法正确带上敌人/玩家冲@Decay

**工程工具**

- ✨新增: 将[物品列表](https://dikpa4hrtn9.feishu.cn/wiki/IbdswSAf1iFX9Ik5LRDcg02LnTb?from=from_copylink&sheet=9O8bx3)：Sheet = 武器配置 纳入DT更新管理
- 这个应该是目前除了关卡， 最耗时的配置项，而由于我的武器配表非常完整，所以一旦迁移成功，应该可以大幅降低配置的耗时
- 由于字段太多，不在此详述，只描述几个核心问题
- ID以及各个插图会继续用Ref指向位置
- 这个DT需要支持类似AI敌人的“应用到BP”的功能，因为武器还是要创建一系列ID来实现被打印机调用、被玩家使用等功能；相当于DT会自动化复写这些ID的值
- 由于每个的武器会有多个可用的技能，本来是在ID里有个List，然后List里配置SDA，如何把技能这个List内容配置到武器是个问题
- 我本来考虑过直接给Spell配适配的武器类型Tag，然后武器ID自动化根据武器类型Tag获取自己能随机到的技能
- 这个方法能成立，和我们的游戏玩法有核心关联性：
- 不同种武器之间的技能不重叠
- 每一种武器能获得的技能（池）相同
- 相对的，DT中就不保存SDA技能信息，而ID中的技能List做成“可编辑”（不像其他的内容被DT锁住）
- 如果是空的，那就继承武器类型Tag对应的池子
- 如果有内容，以手填内容优先
- ✨新增: 将义体配置纳入CSV更新管理
- 和武器类似，更简单一些
- ✨新增: 将智脑配置纳入CSV更新管理
- 和武器类似，更简单一些
- ✨新增: 制作支持 Shipment Package 的 Fake Console

**✔完成**

- ~~🪡修改: SOUND PERCEPTION增加广播距离，不同行为可以配置不同的距离@阿之~~
- 现在：AI能够触发SOUND PERCEPTION的标准是：发声源到AI距离 < PERCEPTION距离
- ~~改成：与门双标准：~~
- 发声源到AI距离 < PERCEPTION距离 && 
- 发声源到AI距离 < 发声源配置的声音广播距离

![...](../跃入迷城%20-%20子版本规划/images/跃入迷城%20-%20v0.0.6.001.png)

- AI 1在SOUND SOURCE广播范围内，且SOUND SOURCE在AI 1听力范围内，因此AI 1可以听见SOUND SOURCE
- AI 2在SOUND SOURCE广播范围内，但SOUND SOURCE不在AI 2听力范围内，因此AI 2不可以听见SOUND SOURCE
- AI 3不在SOUND SOURCE广播范围内，即使SOUND SOURCE在AI 3听力范围内，AI 3也不可以听见SOUND SOURCE
- AI 4在SOUND SOURCE广播范围内，且SOUND SOURCE在AI 4听力范围内，但因为隔了墙壁，因此因此AI 4不可以听见SOUND SOURCE
- 实际计算的时候应该是获取一下两个（SOURCE, RECEIVER）的距离，然后把距离和HEARING, BROADCAST（+上衰减）距离都做一下比较，与门通过就好
- ~~✨新增:  开关门增加声音广播@阿之~~
- 统一配置在PROJECT SETTINGS - GAME - PFGAMEPLAY SETTINGS - AI - NOISE INFO MAP
- ~~✨新增: 完成场景内 HUD 配置，替换新资产@阿之~~
- ~~远程武器Reload效果@阿之~~
- ~~体力消耗效果@阿之~~
- ~~✨新增: 尝试用LGUI完成透视效果@阿之~~
- 不好用，最后集中处理透视和模糊问题
- ~~🪡修改: 调整AI TEAM广播@Decay~~
- ~~当AI其他PERCEPTION更新时，播报一次TEAM广播，位置是最新的PERCEPTION~~
- ~~AI自己应该是看不到这个广播出去的PERCEPTION的，要么就是做特殊逻辑；要么就是做成两个PERCEPTION，然后BT里只处理其中一个，这里我们叫对外生成的为TEAM SEND~~
- ~~如同听力、视觉，在范围内，AI可以接收到来自队友的TEAM广播，生成一个TEAM RECEIVE（假设我们按上文做了双PERCEPTION逻辑）~~
- 范围就在AIC里正常配置
- TEAM RECEIVE一次只有一个，如果范围内有多个，总是用最新的更新
- TEAM RECEIVE的接受条件，判定对象是TEAM SEND的发起者是否在TEAM RECEIVE的范围内，而非TEAM SEND的坐标本身，示例如下：

![...](../跃入迷城%20-%20子版本规划/images/跃入迷城%20-%20v0.0.6.002.png)

- 如图，如果AI 1触发并广播了TEAM SEND 1，此时AI 3应该是无反应的，而是AI 2获得TEAM RECEIVE，位置在AI 1的TEAM SEND
- 不同于听力，TEAM没有接收范围，在广播范围内就可以接收，基于此，上述设计应该会比较好实现（因为TEAM SEND不会广播，AI 1才会）
- ~~BT里，我会让TEAM RECEIVE成为索敌的PERCEPTION之一（和伤害、听力、触碰、视觉记忆平级），AI应该用最新的PERCEPTION索敌，但这个逻辑似乎我没实现好~~
- 目前的设计是，team是以广播为形式触发的（由发出者属性决定距离）
- ~~✨新增: 将[关卡设计](https://dikpa4hrtn9.feishu.cn/wiki/SBUQw11QGiUvvNkDo8OcqZNfnOe?from=from_copylink&sheet=7unVXg)：Sheet = 武器打印机掉率/安全屋打印机调率纳入DT更新管理，实现随关卡成长掉落~~
- ~~✨新增: 将[关卡设计](https://dikpa4hrtn9.feishu.cn/wiki/SBUQw11QGiUvvNkDo8OcqZNfnOe?from=from_copylink&sheet=7unVXg)：Sheet = 关卡配置 纳入DT更新管理@阿之~~
- ~~移除DA，合并DT\_LevelStream\_JAMRelease把功能统一到DT\_LevelStream\_Labor（新增，我目前想是一个BOSS放在一个DT里，以后是否合并另议）~~
- ~~包含该表中：[关卡设计](../跃入迷城 - 数据库/关卡设计.md)关卡配置SHEET的内容~~
- RowName：Int；填写数字，基本上就是编号
- MapRef：Ref；来自DT；填写UE相对引用，指向关卡地图
- EnemyRef：Ref；来自DT；填写UE相对引用，指向匹配该关卡的敌人地图
- RewardRef：Ref；来自DT；填写UE相对引用，指向匹配该关卡的奖励设施地图
- SectionID：Int；来自DA
- AllowLevel：String；来自DA；这个比较搞，因为我实际会填写“1, 2, 4”这样，DT当然可以用String存这个信息，但在执行的时候需要用代码拆分
- MapType：INT；来自DA的IsInitial，但我扩展成了分类Int，包含：0 = 常规、1 = Initial、2 = 奖励关（不需要电梯卡就能离开）、3 = Boss关（可能不需要？）
- StartFacing：来自DA；由于我们需要在load关卡前就判断关卡的情况，因此需要保留。
- 此时，真的起点电梯的朝向无效
- ~~特别移除以下信息：~~
- SafeRoom：来自DA，不需要，或者说不出现在这里，可以用单独的DA/DT管理SafeRoom；或者当前DA\_LevelDef就保留该功能就好
- CombatLevel：来自DA，不需要，或者说不出现在这里，可以用单独的DA/DT管理SafeRoom；或者当前DA\_LevelDef就保留该功能就好（但多BOSS的时候感觉会有BUG）
- EndElevatorFacing：来自DA，同上；
- 这里要处理一种特殊情况：BOSS房是没有结束电梯的，玩家只能走SECTION GATE离开；而SECTION GATE其实也没有结束电梯，应该是阳台去下一个BOSS战斗区域（DEMO里是阳台回家）
- 此时，真的终点电梯的朝向生效
- **上述几个Start、End的特殊情况的展开解释：**
- 由于End字段移除，显然我们只能通过判断电梯来判断具体的“楼层升降”走向
- Boss房结束后无法坐电梯去更高层
- 而Boss奖励房不应该能坐电梯进入、也不能坐电梯去更高层
- 因此虽然看似字段bug，但其实只要LevelManager能包容
- 没有结束电梯的Boss房
- 没有开始电梯 / Player Start的Boss奖励房
- 就自然合理了
- NeedReload：Bool；来自DT；有一说一我现在所有的NeedReload都是True，不知道为什么还要配到表里；另外本来NeedReload是根据MAP来的，现在一个MAP一行，没办法细分，干脆移除
- DefaultVisibility：Bool；来自DT；同NeedReload，现在都是False
- ~~🐛修复: AI寻路卡死问题@Decay~~
- ~~🪡修改: 消耗体力的动作未触发成功时，不应重置体力恢复的间隔（避免玩家无脑按攻击，一下子都攻击不出来）@Decay~~

**🎨艺术**

**GUI**

**场景美术**

**✔完成**

- ~~🪡修改: 无人机概念稿@瞿敬雄~~
- ~~🪡修改: 地板概念稿@瞿敬雄~~
- ~~✨新增: 城市俯瞰概念稿@瞿敬雄~~
- ~~🪡修改: 劳旅栏杆扶手设计稿~~
- ~~🪡修改: 更新阳台下翻结构背面的设计稿~~

**地编&模型**

- ✨新增:搭建SEC01\_01场景@杨清龙

**✔完成**

- ~~🪡修改: 电梯@杨清龙~~
- ~~✨新增: 拱门@杨清龙~~
- ~~分件~~
- ~~✨新增: 扶手@杨清龙~~
- ~~尝试增大倒角~~
- ~~分件~~
- ~~🪡修改: 墙壁~~
- ~~墙壁的底部贴图不对，这里的斜面和水平面应该都还是白色（护板颜色）这里窗（右边）的底部是对的~~

![...](../跃入迷城%20-%20子版本规划/images/跃入迷城%20-%20v0.0.6.003.jpeg)

- ~~🪡修改: 窗~~
- ~~窗的螺钉（上、下）应该跟墙壁一样，这里不对（位置和造型）~~

![...](../跃入迷城%20-%20子版本规划/images/跃入迷城%20-%20v0.0.6.003.jpeg)

- ~~窗的UV没切对，中间这个缝隙没有颜色（所有的都不对，有的甚至没有面）~~

![...](../跃入迷城%20-%20子版本规划/images/跃入迷城%20-%20v0.0.6.004.jpeg)

- ~~小开口窗的中间循环部分顶部有缺口~~

![...](../跃入迷城%20-%20子版本规划/images/跃入迷城%20-%20v0.0.6.005.jpeg)

- ~~大开口窗的端部，不管是A还是Btype（有无螺钉）似乎都有问题：Btype（有螺钉的）面突出了，Atype和墙壁之间有色差（小开口就没有~~

![...](../跃入迷城%20-%20子版本规划/images/跃入迷城%20-%20v0.0.6.006.jpeg)

- ~~大开口窗的循环部分原点不对~~

![...](../跃入迷城%20-%20子版本规划/images/跃入迷城%20-%20v0.0.6.007.jpeg)

- ~~现在似乎只有大开口窗的端部背面是正常透明的，其他模型都有颜色，这个知道是为什么吗？~~

![...](../跃入迷城%20-%20子版本规划/images/跃入迷城%20-%20v0.0.6.008.jpeg)

- ~~所有窗的双面模型没有做~~
- ~~🪡修改: 立柱@杨清龙~~
- ~~带切角的Pillar不对~~
- ~~🪡修改: 门@杨清龙~~
- ~~调整凹陷特征~~
- ~~调整区域门~~
- ~~门框和门板都有点超厚，门板现在是50，门框是70，我算了下门板35门框60差不多，我用缩放做出来的效果是这样：~~
- 压缩后

![...](../跃入迷城%20-%20子版本规划/images/跃入迷城%20-%20v0.0.6.009.jpeg)

- 压缩前

![...](../跃入迷城%20-%20子版本规划/images/跃入迷城%20-%20v0.0.6.010.jpeg)

- 其实你看上图，压缩前也还算匀称，但现在所有门板的黄色面两面，都是50的厚度，要缩小到35，否则墙壁藏不下，所以匹配着就只能压缩了
- 我本来想直接自己整的，用BP里的缩放，但我想到我还要做碰撞体，你要是更新了我要重做一遍，所以你还是辛苦更新下吧
- 另外我压缩了尺寸以后因为是整体缩放的，控制面板（左边立柱上的屏幕）也变得更扁了，我反而觉得效果不错？你处理的时候可以看看
- ~~电梯门的门板没做~~
- 这个既然做新的了，直接按照35的尺寸做就好

**平面美术@李贺**

- ✨新增: [“掮客” - 伽拉缇](../跃入迷城 - GDD/故事/设定Wiki/角色/友方NPC/“掮客” - 伽拉缇.md) 姿势1@李贺
- ✨新增: [“掮客” - 伽拉缇](../跃入迷城 - GDD/故事/设定Wiki/角色/友方NPC/“掮客” - 伽拉缇.md) 姿势2@李贺
- 🪡修改：调整 [“枪匠” - 阿裕](../跃入迷城 - GDD/故事/设定Wiki/角色/友方NPC/“枪匠” - 阿裕.md)姿势2嘴部造型

**✔完成**

- ~~✨新增: [“枪匠” - 阿裕](../跃入迷城 - GDD/故事/设定Wiki/角色/友方NPC/“枪匠” - 阿裕.md)姿势2~~
- ~~细化全身阴影~~
- ~~✨新增: [“枪匠” - 阿裕](../跃入迷城 - GDD/故事/设定Wiki/角色/友方NPC/“枪匠” - 阿裕.md)姿势1~~
- ~~细化面部阴影~~

