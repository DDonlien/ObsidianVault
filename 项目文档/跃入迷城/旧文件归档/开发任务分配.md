
**开发任务分配**

**@Decay**

**战争迷雾**

```<p>- **整体诉求**</p><p>- 玩家的在屏幕上会看到以主控角色为中心，朝向主控角色面前扇形展开的范围内的视野</p><p>- 锥形范围以外的空间，应当由2层战争迷雾遮挡</p><p>- 第一层为黑色，在完全未探索（玩家视野没有扫过）的区域覆盖</p><p>- 第二层为灰色，在玩家已探索过，但现在未在视野内的区域覆盖</p><p>- 基于以上设计，玩家屏幕内的空间应当被分为以下3个区域：</p><p>- 黑色迷雾区域</p><p>- 灰色迷雾区域</p><p>- 视野区域</p><p>- 灰色和黑色区域应该都是黑色遮罩+不透明度实现，灰色不透明度 = {50%}</p><p>- 灰色迷雾区域内，所有“character”不可见</p><p>- 灰色迷雾区域内，所有“actor”维持最后一次看到的状态（不刷新，war3）</p><p>- 视野区域的扇形，其锥顶应当以玩家主控角色为中心，扩展一个半径为Y的圆（周边视野）</p>
```
- 互动关系：
- 蹲伏
- 游戏中玩家蹲伏会影响视野，所有静止物体都有“完全遮挡视野”和“只遮挡蹲伏视野”和“不遮挡视野”三种情况
- 游戏中的蹲伏视野、碰撞交互的状态各有YES/NO两个情况，排列组合为：
- 阻挡蹲伏移动，不阻挡蹲伏视野：栅栏之类
- v0.1.0不出现
- 不阻挡蹲伏移动，不阻挡蹲伏视野：开放道路，无需多言
- 不阻挡蹲伏移动，阻挡蹲伏视野：不会出现
- 阻挡蹲伏移动，阻挡蹲伏视野：桌椅、掩体等
- 敌人和物品遮挡
- 所有Pawn都应该在灰色层被隐藏
- 所有Actor都应该在灰色层被锁定（不更新视觉）
- 实现效果和war3一样
- 追加功能：
- 进入电梯间（不是电梯厅）后，战争迷雾只保留黑色层，灰色层在x秒内变成黑色
- 目的：为了做开关电梯门时的视觉特效（玩家只看得到电梯间内，然后关卡外部换）
- 实现：做一个把灰色层的不透明度随设定时间调高到100%的小功能？
- 关于高低差的实现，我想象中的战争迷雾应该是这样的

![...](images/开发任务分配.001.jpeg)

**角色控制**

- 角色移动
- 远程攻击
- 近战攻击
- 按F触发近战攻击
- 如果玩家手持非近战武器，对面前扇形范围造成固定伤害
- 如果玩家手持近战武器，等同于按下鼠标左键
- 如果敌人未发现玩家且背对玩家（需要有一个扇形判定区域判断是否“背对”），或者敌人处于大硬直状态，触发一次处决
- 处决应当由触发者传递处决伤害给被处决者，但由被处决者的GA决定处决动画和动作
- 这样，在不改变处决系统的情况下，只需要改变个别单位的GA就可以改变对应单位的处决效果
- 处决状态下的双方都免疫伤害和位移效果
- 直到v0.1.0版本，所有非boss单位的被处决动画用一套
- 翻滚
- 蹲伏

**武器系统**

- 武器系统在游戏中的应用，见此篇内容：[角色系统 & Build](https://dikpa4hrtn9.feishu.cn/wiki/JL8fwgzNNilRxekcVN0cvQgpnCe?fromScene=spaceOverview#part-KbdidW8Z2oPRsLxzeRFcC5XXnhf)
- 持有武器
- 子弹
- 玩家的武器有有限的子弹，可以按R主动换弹，消耗完弹夹内最后的子弹后，再次攻击会自动触发换弹
- 每次攻击消耗和生成的子弹数量应该为x、y，每把武器可以单独配置
- 从打印机获得新武器
- 从敌人尸体上拾取子弹
- 武器打印机
- 和义体打印机同理
- 物品UUID
- 该主题与批量导入数据主题相关
- 所有物品、技能、义体、武器，都应该有自己的UUID
- UUID应该支持英语字母和数字，大小写不敏感，便于在游戏外通过CSV、EXCEL维护
- UUID应该由3个部分组成
- 前3位字母，代表品类缩写
- 后6位数字，用于自增
- 游戏中应该至少有以下类型的道具：
- 武器
- 技能
- BUFF
- 义体
- 弹药
- 回复道具
- 关卡道具
- 剧情道具
- 例如：
- WPN000001（武器 Weapon）
- SKL000001（技能 Skill）
- BUF000001（BUFF）
- CYB000001（义体 Cybernetics）
- AMM000001（弹药 Ammo）
- HPT000001（回复道具 Healing Potion）
- LVL000001（关卡道具 Level Item）
- STY000001（剧情道具 Story Item）
- 武器&义体升级
- 武器和义体有“制造工艺”之类的物品等级，基本就是老头环里的武器等级
- 武器和义体的升级我还在纠结是
- 方案1：数值驱动，每次升级更新驱动数值
- 方案2：每个手动配，每次升级换一个新等级的武器上来
- 投掷武器
- 需要一个有抛物线的投掷武器（手雷）
- 跟普通武器一样占一个格子
- 按下左键展示抛物线预览，放开丢出
- 抛物线的最远距离和顶高应当可配置
- 投掷物的触发条件应该有多种在模板内可选（下拉选单之类）
- 先做“使用后定时触发”即可
- 投掷物的效果应该是单独的GA/GE/你懂就行，丢出去触发，触发条件见上一条
- 先做“造成范围伤害”即可
- 近战武器

**属性系统**

属性在游戏中的呈现，应该符合：[角色列表](../跃入迷城 - 数据库/角色列表.md)

- 生命值
- 护甲值
- 体力值和体力值恢复
- 能量值和能量值恢复
- 韧性值和硬直
- 韧性基于体力&护甲转换，韧性上限 = 韧性系数 x ( 0.5 x 生命值 + 1.5 x 护甲值 )
- 硬直点用于等分韧性值，每次韧性值低于一个硬直点，角色会做一次小硬直动作
- 例如，硬直点 = 4，韧性值 = 100，则韧性低于80、60、40、20时，会触发一次小硬直动作
- 韧性消耗完，角色会进入大硬直，直到快速恢复所有韧性值
- 玩家可以对大硬直的敌人进行近战攻击，造成处决

**技能系统**

- 独立可用的技能
- 每个技能应该是一个独立的item（实现方式不限，只是一个例子，maybe是GA？）
- 技能应该有可反复使用的模板，这样策划可以量产新技能，但每个技能都会有不同的效果，如何在技能之间复用类似的效果有开发决定
- 比如两个技能都是持续使用、持续消耗能量、使用时降低移动速度
- 但一个是开火后进入CD，这次开火造成双倍伤害
- 另一个是开火后进入CD，这次开火不消耗弹药
- 这里持续使用、持续消耗能量、使用时降低移动速度都是可复用的

**@Daylight**

**义体系统**

- 义体系统在游戏中的应用，见此篇内容：[角色系统 & Build](https://dikpa4hrtn9.feishu.cn/wiki/JL8fwgzNNilRxekcVN0cvQgpnCe?fromScene=spaceOverview#part-HOGedXEKYoJUxlxmKS4cveHWnif)
- 角色的义体栏
- 义体应该类似于有技能的物品，或者类似于普通RPG游戏中的玩家装备
- 玩家装备义体后，获得对应的技能和属性加成
- 属性加成直接生效到“固定附加”，详见[角色列表](../跃入迷城 - 数据库/角色列表.md)
- 技能附加到技能系统
- 义体消耗“义体容量”，类似于普通RPG游戏中的“负重”，义体容量是玩家/角色拥有的一个属性，但装备义体消耗类似于受伤掉血而非降低血量上限性质的消耗
- 可用的义体物品
- 义体物品应该有可反复使用的模板，这样策划可以量产新义体
- 义体应当包含的数值见[物品列表](https://dikpa4hrtn9.feishu.cn/wiki/IbdswSAf1iFX9Ik5LRDcg02LnTb?from=from_copylink)里的义体列表
- 义体所附带的技能是单独的技能模块
- 义体打印机
- 交互后弹出UI，从列表（文件夹）随机选择3个义体，可以选择其一获取
- 如果是已有的义体，失去原有义体
- 可以重新随机待选列表（参考土豆兄弟）
- “融合打印”功能
- 简单来说就是交换义体上的技能

**关卡系统**

- 玩家在游戏中推进关卡流程的情况，见此篇内容：：[游戏流程 & 关卡](https://dikpa4hrtn9.feishu.cn/wiki/ET3swN411i9Rj7k7mMNcjI6hnTh?fromScene=spaceOverview#part-UkEhdLDDHoZsh6xVIogcfjZanCJ)
- 随机的关卡生成
- 关卡是预先配置的场景，每层是一个stream level（后半句不重要，如果别的实现更好就换）
- 每个boss的关联关卡（可能5~20个LevelBP）会存在一个文件夹里，每次生成时从其中挑选
- 挑选的规则是这样的：每层会有1~N个候选LevelBP，例如Level\_1\_A, Level\_1\_B
- 当玩家到达Level\_1时，会从A, B随机选一个生成
- 敌人是预先配置在Level\_1\_A和Level\_1\_B中的，这样可以设计具体的转角杀、怪物配置和强度
- 随机到A, B对玩家并不重要，因为视觉风格是统一的，且奖励物和敌人强度是基于Level驱动的
- 关卡需要携带一个（或者一组）数值，用来给怪物定义强度（参考老头环的地区强度）
- 敌人属性 = 基础属性 + 关卡加成（每一项都是）详细的属性构成见属性列表
- 关卡推进
- 玩家击杀所有敌人后，获得电梯权限，回到电梯厅则可以选择乘坐电梯前往其他楼层
- 这个部分参考物品掉落
- 电梯权限是一个int，决定玩家能移动多少层（其实就是前进到lv几），电梯的移动规则有2套，二选一：

```<p>- **权限方案1：电梯可以向上或向下坐（+1、+2、+3、-1、-2、-3）**</p><p>- 如果向下的楼层有已经去过的楼层，则不能访问更低的楼层 </p><p>- 如玩家从Lv3→Lv5，在Lv5拿到Access=3，则最多向下回到Lv4，向上到达Lv8</p><p>- 继续上述假设，如果玩家在Lv8拿到了Access=3，向下回到Lv6（显然，不能回到Lv5）则Lv6不论掉落Access=几，+2都会NO ACCESS（不能回到Lv8）且此时Lv7至少会掉落Access=2。</p><p>- Pros：关卡设计更新颖；在保证期望关卡数不变的前提下，需要设计的关卡更少；</p><p>- Cons：关卡流转机制开发上比较复杂，玩家体验不直观；</p><p>- **权限方案2：电梯只能向上坐（+1、+2、+3）**</p><p>- 如果可访问的高层有Boss关，最多只能到Boss关</p><p>- Pros：关卡流程更简单直接</p><p>- Cons：需要制作更多关卡保持期望关卡数不变；玩家会快速跳过非Boss关；反之，玩家可能在非Boss关耗时太久，变的太强；</p><p>
同步自文档: <https://dikpa4hrtn9.feishu.cn/docx/DTCBdr4q6ozOf3xuHXbcpGNKnLb#TQmZdfJEzsGyU1bpD2jcbN5innb></p>
```
- 奖励房间生成
- 每个LevelBP应该在地图上有1~N个房间，相同风格的关联关卡，应当只有2、3种房型（面积和长宽比）
- 针对每种房型，预设2、3种家具组合（包含敌人）
- 一组家具应该是一个BP，其中至少一个BP应该是奖励房间BP，也即组合中包含打印机
- 奖励房间的家具BP组合一定不包含敌人
- 打印机只用来交互 -> 调用奖励生成系统，奖励生成系统本身是单独运行的，和实际生成的家具组合无关

**奖励系统**

- 游戏中有以下几个奖励机器：[游戏流程 & 关卡](https://dikpa4hrtn9.feishu.cn/wiki/ET3swN411i9Rj7k7mMNcjI6hnTh?fromScene=spaceOverview#part-Szqxdkj7UooxqExzgNzcH0XTn1g)
- 其中，恢复机器最简单，直接给数值
- 升级机器相对简单，调用UI，选择升级的武器或者义体即可
- 升级其实就给所有武器做1~5五个BP（假设一共有5个），然后直接切换，并且把技能复制粘捏
- 打印机最复杂：需要基于规则生成对应的候选项，然后获取，还要能进行“融合打印”

**UI系统**

**对话UI**

**菜单UI**

**角色状态UI**

**奖励系统UI**

- 义体打印机
- 武器打印机

**联机系统**

- 在v0.1 Steam EA版本中，玩家可以进行Host/Server形式的联机，最多4人
- 联机方式
- 方案1：房主可以在阳台选择“开放地址”
- 方案2：房主可以在终端选择“开放地址”
- 访客可以在阳台选择“前往猎杀”或者“拜访好友”，如果选择“拜访好友”，弹窗可拜访的好友列表
- 选择后坐飞空车前往
- 联机存档
- 联机时，公寓的配置跟随房主（打印机等级等）
- 所有设备只有1个人能同时访问
- 访客无法访问终端
- 设定上：Misty不希望身为游民的各位，知道彼此的中间人都是她，所以终端机都是唯一加密的
- 访客可以访问阳台叫车，断开连接
- 访客/房主可以访问阳台叫车，出发下一次挑战，但需要全员上车
- 访客会携带自己的信用点来访，在和打印机交互时使用
- 敌人的难度和进度也跟随房主
- 剧情交互对象只有房主可以交互，如NPC
- 常规情况下，玩家可以攻击NPC
- 联机情况下，房主依旧可以攻击NPC，而访客对NPC的攻击将会被无视（子弹不碰撞）

**@李少秋**

**AI系统**

- 敌人基础AI
- 敌人AI应该能对玩家的视觉、声音做出反应
- 硬直和硬直响应应该是一个character特性，而不是状态机动作@Decay
- 敌人AI设计见下表：
- 敌人AI对玩家的感知有以下几种状态
- 巡逻：
- 完全丢失玩家位置
- 行动：范围内随机巡逻
- 勘察：
- 大概知道玩家位置（记忆 / 听觉 / 伤害），尚未勘察记忆是否可靠
- 行动：前往待勘察地点
- 索敌：
- 明确知道玩家位置（队友看到），但玩家位置在自己的视野范围外
- 战斗：
- 玩家在自己视野范围内（可以在攻击范围外），进入战斗流程

![...](images/开发任务分配.002.jpeg)

- AI调用玩家能力
- AI应当可以持有武器、使用技能、使用玩家动作（冲刺、蹲伏）
1. BTT\_ChasePLayer。考虑到武器范围应当是每个角色不同，甚至是可能实时变换的，应该是pawn的一个方法

![...](images/开发任务分配.003.png)

1. BT\_Patrol Speed应该从pawn身上获取

![...](images/开发任务分配.004.png)

- AI判断和玩家的阻拦关系
- 为了实现AI策略，需要增加一个射线判断，判断AI自己和玩家之间的连线是否被阻拦
- 该判断与视野不同，应该能识别蹲伏后的掩体的遮挡（这类掩体不遮挡视野）以及透明的掩体（电磁护盾之类），并且能识别对应掩体的某些属性（比如是否可破坏）
- 比较简单的方法，是从AI划一根到达玩家头部的高度（或者胶囊体顶部-30的高度）的水平线，这时候玩家如果蹲了，水平线的绘制也会变，就可以通过判断这个ray打到什么物体来判断阻拦情况
- 基础远程AI

![...](images/开发任务分配.005.jpeg)

- 移动攻击
- 步行前进和步行后退，应该分别至少移动到射程的50%，再切换到站定攻击，以避免反复触发的情况。
- 特殊攻击

- 寻找掩体

- 攻击欲望驱动

**剧情系统**

**切片（v0.0.1）**

只要能实现在特定关卡、节点触发剧情判定（也许是门的访问权限、也许是触发对话）即可

**存档系统**

- 基础的存档系统
- 切片版本：
- 游戏提供1个存档slot给玩家，自动连贯存档
- 每次可以选择新游戏或者继续游戏，如果选择新游戏，会失去存档从头开始
- EA版本：
- 游戏提供3个存档slot给玩家，自动连贯存档，可以“载入”；每个slot彼此独立
- 存档应该存储所有剧情、属性等进度状态
- 存档节点
- 玩家和电梯交互，进入到某个楼层后（也包括第一次进入一楼），自动存档（以防玩家重启游戏刷层）
- 玩家杀死每层的最后一个敌人后，自动存档（以防玩家刷奖励？）
- 玩家死亡后，自动存档
- 玩家在公寓进行任意资源消耗或完整NPC对话后，自动存档
- 没有手动存档

近战攻击的【抬手追踪 -> 停止追踪 -> 造成伤害】整体都在GA里实现

AI的寻址都用EQS实现

**TBD**

- 打包计划和流程


