
**物品配置**

**Setup**

创建一个PFInventoryItemDefinition (**简称ID**)

- 24/10/07: 如果创建义体，记得创建ItemDef\_Cyborg\_Base (继承自PFInentoryItemDefinition)，武器则是ItemDef\_Weapon\_Base。这样做的好处是
1. 在某些下拉窗里可以用来过滤物品类型，比如配置义体打印机列表的时候就可以只显示义体ID，而不是所有物品ID
2. 利用继承的优势，也就是可以将Fragment在ItemDef\_Cyborg\_Base 里配好，而不是每次开新ID都要重新点Fragment
3. 现在义体ID上试运行一下，如果效果好后续其他ID也会分类，例如ItemDef\_Weapon\_Base

![...](../../../跃入迷城%20-%20GDD/开发/常见问题/images/物品配置.001.png)

![...](../../../跃入迷城%20-%20GDD/开发/常见问题/images/物品配置.002.png)

创建出来的ItemDef大概长这样

1. 所有物品的通用字段，比如名字，描述，UUID
2. Fragment区，每种Frag是一个物体的切面，图中a/b/c为三个frag
1. InventoryFragment\_EquippableItem: 可装备物品，定义内容有装备后授予的AbilitySet、装备后显示的模型
2. InventoryFragment\_RangedWeapon (**简称RangedWeapon**, 近战Frag InventoryFragment\_RangedWeapon **简称MeleeWeapon**): 远程武器，定义内容有远程武器独有的弹容量，弹发量等以及所有武器通用的攻击间隔、射程等。
1. InventoryFragment\_Weapon为通用武器定义，InventoryFragment\_RangedWeapon和InventoryFragment\_MeleeWeapon继承自这个通用定义，分别为远程/近战武器定义，**添加近战/远程Frag会自动添加父类Frag** (图中也可以看出)，因此确定武器是近战还是远程后从子类中选择即可，不要再单独添加父类
3. InventoryFragment\_QuickbarIcon: 物品放入QBar时的图标 (很早做的功能，后续应该会改成不仅限于QBar)

实际例子可以看看/Content/Weapons/MachinePistols/ID\_MachinePistols，**包括文件结构的组织 (<武器名>文件夹下分别放ID、ActorToSpawn、Meshes文件夹)**

```<p>Q&A：</p><p>1. Faction是干吗用的？@Decay</p><p>a. 武器阵营，看下面的[物品配置](https://dikpa4hrtn9.feishu.cn/wiki/Ho2BwFXebiZs7gkNtewcNEBMnoe#QAPpdxxwpo7Z8Vx8HNpcC8Ltn7e)有策划表和ID的对应关系</p><p>2. 我用你的类创建的应该是ID\_WPNXXX，那BP\_WPNXXX我要继承哪个类吗？@Decay</p><p>a. BP\_VisibleEquipBase，下面都有写[物品配置](https://dikpa4hrtn9.feishu.cn/wiki/Ho2BwFXebiZs7gkNtewcNEBMnoe#J2Iddboiho1PxLx8hM1cpo3OnFf)</p><p>3. 你这个UI插图T\_UI是自己做的还是有规则生成的呀@Decay</p><p>![...](../../../跃入迷城%20-%20GDD/开发/常见问题/images/物品配置.003.png)</p><p>a. 自己截的，确定要规则生成也能做，不过要时间</p><p>b. 截图it is</p>
```
**项对应**

![...](../../../跃入迷城%20-%20GDD/开发/常见问题/images/物品配置.004.jpeg)

**点击图片可查看完整电子表格**

**ID中未在策划表中出现的项**

大多为技术相关的配置，但为了让效果正确，也需要手工配一下

1. ~~InstanceClass: 远程武器设为PFWeaponInstance\_Ranged，其他设置为PFWeaponInstance，**不要设置为UPFInventoryItemInstance！目前这么设置会导致崩溃！**~~
- ~~这个项后续应该会自动处理掉，不再需要手动配~~
- 24/10/01: 这项已经去除，不需要手动配置
2. InventoryFrag\_EquippableItem.AbilitySetsToGrant: 远程武器选AbilitySet\_WeaponCommon\_Ranged / 近战武器选AbilitySet\_WeaponCommon\_Melee. 针对特殊武器后续会开发特殊AbilitySet
3. InventoryFrag\_EquippableItem.ActorSpawnInfo: 决定武器模型和吸附位置，以及额外的吸附Transform
- ActorToSpawn: 决定武器模型，必须派生自特定类，并在蓝图里指定骨骼网格，具体看 [物品配置](https://dikpa4hrtn9.feishu.cn/wiki/Ho2BwFXebiZs7gkNtewcNEBMnoe#J2Iddboiho1PxLx8hM1cpo3OnFf)
- AttachSocket: 吸附点，用默认的WeaponGrip\_R应该就够
- AttachTransform: 额外变换，默认的武器握法不满意时可以在这里调整
4. InventoryFrag\_RangedWeapon.ReloadAnim: 装填动画，必须为Montage。为空则不播动画，但还是会有装填时长判定
5. InventoryFrag\_Weapon.ArmType: 影响装备武器后的动画类型，装备不同武器人物有不同动画 (目前主要影响走跑蹲，不影响攻击/装填/翻滚动画）
- ArmType.None: 空手动画
- ArmType.Rifle: 双手长枪动画
- ArmType.Pistol: 双手短枪动画
- ArmType.Melee.OneHand: 单手近战动画
- InventoryFrag\_Icon: 主要配里面的Image，作为武器图标

**ActorToSpawn**

必须继承自BP\_VisibleEquipBase。创建好之后选择SkeletalMesh组件，指定其SkeletalMeshAsset即可

![...](../../../跃入迷城%20-%20GDD/开发/常见问题/images/物品配置.005.png)

这也就意味着武器模型必须是骨骼网格，如果美术资产是StaticMesh的话，就要先转换成SkeletalMesh。现在项目启用了一键转换插件，直接右键StaticMesh，Convert to Skeletal Mesh

![...](../../../跃入迷城%20-%20GDD/开发/常见问题/images/物品配置.006.png)

弹窗询问骨骼，选Create New，这样会自动生成一个单根骨骼，用来加socket足够用了

**枪口Socket**

远程武器要设置枪口Socket才能正确开火和处理各种逻辑

1. 打开你要加socket的SkeletalMesh
2. 确保自己在骨骼编辑器中，这个窗口的功能比较方便

![...](../../../跃入迷城%20-%20GDD/开发/常见问题/images/物品配置.007.png)

3. 左侧骨骼树，直接右键根节点，Add Socket

![...](../../../跃入迷城%20-%20GDD/开发/常见问题/images/物品配置.008.png)

4. 名字后带Socket的就是新创建的Socket，按f2改名，将名字改为MuzzlePoint。建议养成习惯去其他已经做好的SKM里面复制这个socket name，这样不会出拼写错误，导致一系列难Debug的问题
5. 选中改好名的socket，右侧视窗里应该能看到这个点，按W切换到位移模式，将它拖到枪口上 (善用front/right/back视图来对准中心，另外不要动横向轴，图里是x轴，这样枪口永远在中轴线上)

![...](../../../跃入迷城%20-%20GDD/开发/常见问题/images/物品配置.009.png)

![...](../../../跃入迷城%20-%20GDD/开发/常见问题/images/物品配置.010.png)

6. 确保处于局部坐标系，按e切换到旋转模式，拖动绿轴将红色的x向量对准前方，这步是为了确保子弹的前进方向。我这里顺时针转了90度后就对准了，实操中可以反复尝试找到正确的旋转

![...](../../../跃入迷城%20-%20GDD/开发/常见问题/images/物品配置.011.png)

![...](../../../跃入迷城%20-%20GDD/开发/常见问题/images/物品配置.012.png)

**Debug开关**

- 弹药散布可视化
- Content/Characters/BP\_PFHeroCharacter.DrawSpreadInfo

![...](../../../跃入迷城%20-%20GDD/开发/常见问题/images/物品配置.013.png)

- 近战攻击判定可视化
- Content/Game/GameplayAbilities/GA\_WeaponAttack\_Melee.DrawDebugInfo

![...](../../../跃入迷城%20-%20GDD/开发/常见问题/images/物品配置.014.png)


