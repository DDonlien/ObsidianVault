
**关卡设定**

**基本定义**

- 游戏中的关卡视觉、敌人配置和结构由对应的阵营决定
- 例如在Level 1~Level 10，你会遇到[劳旅 (Labor)](../../跃入迷城 - GDD/故事/设定Wiki/阵营/民间组织/劳旅.md)
- 在每个Level玩家会遇到的场景相对随机，但有些具备一定规则
- 例如，你总是在Level 10会遇到[浩的办公室](../../跃入迷城 - GDD/故事/设定Wiki/关卡/劳旅 - 场景/浩的办公室.md)，在Level 1遇到[劳旅大厅](../../跃入迷城 - GDD/故事/设定Wiki/关卡/劳旅 - 场景/劳旅大厅.md)或[卸货入口](../../跃入迷城 - GDD/故事/设定Wiki/关卡/劳旅 - 场景/卸货入口.md)
- 相同场景中会出现的房间可能会变动，但基本符合场景直觉
- 例如，你不会在礼宾大堂场景遇到临时宿舍房间

**变体结构**

- 关卡的阵营归属是最大层级
- 其次是电梯朝向，决定关卡衔接，比较重要
- 其次是Sector外轮廓，只会有小幅度的变化，几乎不变，从这一层开始与程序脱钩
- 再次是Variante内搭变种，这个部分可能有非常丰富的变化，主要是为了充分填充奖励
- Sector的功能定位基于内搭布局决定：很显然一样的外轮廓作为办公室还是食堂全看内搭
- Sector和Sector之间存在重叠，该设计主要便于策划创建多个关卡
- 最后会附上便于理解的Explanation，解释该Sector的剧情功能
- 上述命名规则中，Sector、Variante、Explanation，均不涉及程序考量，仅作为策划记录使用
- 规则解释：
- L：所有Level的开头
- Party：描述所属阵营
- Direction：描述起点、终点电梯的UE绝对坐标朝向
- Sector：描述该楼层的外轮廓面，一并定义了在大厦中水平面的绝对位置
- Explanation：描述该楼层视觉、剧情设计上的用途
- Variante：用于区别相同用途(Explanation)、不同布局的楼层
- Gift：描述该楼层的奖励内容一并影响奖励房间内的布局，但不影响外部
- 因此，关卡命名如下：
- 格式：L\_Party\_Direction\_Sector\_Explanation\_Variante\_Gift
- 例子：L\_Labor\_PosY\_NagX\_S03\_EngineeringZone\_V01\_WeaponPrinter
- 在母关卡中显示为：
- L\_Index
- L\_Labor\_PosY\_NagX\_S01\_EngineeringZone\_V01\_WeaponPrinter
- L\_Labor\_PosY\_NagX\_S01\_EngineeringZone\_V01\_Light
- L\_Labor\_PosY\_NagX\_S01\_EngineeringZone\_V01\_Dark
- L\_Labor\_PosY\_NagX\_S01\_EngineeringZone\_V01\_Enemy

**衔接规则**

![...](../../跃入迷城%20-%20数据库/关卡设计/images/关卡设定.001.jpeg)

**电梯（右图红色小方块）**

一个地图至少有2个电梯，一个入场、一个出场。

- 入场电梯在玩家离开后自动关门，无法交互
- 出场电梯在清场后解锁，变得可以交互。

地图与电梯朝向强相关

- 下一个地图必须和上一个地图电梯朝向一致。
- 显而易见：玩家可能从2个电梯中出现，实际制作中，会把2个电梯情景做成2张地图。
- 地图命名如下（由于现在都在一个L\_BP下，所以每个关卡以文件夹区分）：
- L\_EnemyField\_MapDefinition\_Variant\_StartDirection\_EndDirection

**地图**

地图至少有以下几个信息需要保存，直接存在LevelBP里也就，越简单越好：

- 开始电梯朝向：int、0123对应四个方向
- 结束电梯朝向：int、0123对应四个方向
- 方向定义如下
- 允许出现的层数：int map、数字对应可以出现的level，从1开始
- 外轮廓id：int、用来标识内轮廓不同、但外轮廓相同的地图。

**关卡切换**

玩家与end门交互后，失去控制，演出

- 隐藏ui，画面比例变成21:9上下黑屏，角色自动走入end门，自动关门。

系统从符合条件的地图中随机一张刷新，条件如下：

- 满足层数限制
- 不是当前地图（当前地图有2个定义可能性：基于真的L\_object判断、基于外轮廓id判断，建议先做第一种比较简单，如果不行再改）
- start方向与当前地图的end方向一致

**加载新地图**

- 这里涉及到电梯内应该“看起来”不被加载，要想个办法处理掉
- 需求上，地图的绝对坐标位置不应该约束关卡流转（否则很难对齐模型），也就是说玩家应该从当前地图的end被无感瞬移到下一张地图的start，而start所在位置应该不重要
- 我会在两个电梯里分别放置某个box作为标识，或者直接把电梯bp作为标识，这个看程序实现即可

还给玩家控制权，玩家可以自行开门离开

**敌人刷新**

- 我会在每个楼层里配置好敌人刷新点（test arena里那个）
- 关于敌人补充的功能，会复用“浩”战斗过程中的补充功能，应该包含从阳台/电梯入场的演出
- 阳台入场：可活动围栏下翻，同时浮空车开到围栏边；敌人从车里出来进入战斗空间；围栏翻起浮空车开走
- 该演出也复用于玩家逃生
- 电梯入场：从玩家来的start电梯开门，走出敌人
- 可以作为第二步做这个内容，先实现前面的

**白模**

**搭建规则**

**检查脚本**

使用以下脚本检查关卡衔接和统计概率：

**[LevelCheck.py]**

**结构**

**整体**

1. 原则上不拉伸门和带窗的墙壁模型，如有需要，单独制作
2. 地板和普通墙壁可以任意拉伸（为N的方向）
3. 所有元素以50为最小单位，按世界坐标系，整数放置
4. 各个模型的坐标原点位置各有不同，但尺寸都已经统一整数化，务必注意

**房间**

1. 每个战斗区域至少包含2个房间（确保玩家需要“探索”来找到奖励）
2. 当战斗区域有2个房间时，至少包含1个奖励房间，至多包含3个奖励房间
1. 奖励房间的详细比例参考：[关卡设计](https://dikpa4hrtn9.feishu.cn/wiki/SBUQw11QGiUvvNkDo8OcqZNfnOe?from=from_copylink)
3. 奖励房间内没有敌人，除了特殊的剧情房间，其他房间应该都有敌人
4. 奖励房间只有1个出入口，其他房间可以有1～N个出入口
5. 唯一特殊的奖励：子弹打印机，子弹打印机应该像自动贩卖机一样散布在各处，无需放在奖励房间
6. 只有1个出入口的房间，面积应该控制在玩家屏幕范围内能看清全局，避免回头路
7. 玩家应该有明确的起点和终点，并被场景引导经过一条动线
8. 动线中应该有岔路，让玩家必须进行探索，但岔路需要合并到主动线，且岔路本身不应该太长，从而减少回头探索的疲劳感
1. 考虑到室内建筑的特殊性，拥有2个或以上门的房间应该被视作主动线或岔路的一部分

**地面**

1. 所有可通行区域应该至少有1m的宽度，而不可通行区域宽度应该控制在0.5m以下，以防穿模
2. <= 0.4m高度的地面可以被玩家和敌人直接走上去，>=50则会被视作障碍物，如果要制作悬浮的障碍物平台，注意该数值

**门与窗**

1. 由于所有门都是移门，务必确保两边有足够宽度的墙壁以遮挡可能的穿帮
1. 对于L, M, S尺寸的门，分别是单边3, 2, 1m
2. Prototye的所有障碍物来自于一个MESH，在场景内拉伸以实现差异化
3. 门在场景中需要单独配置NavLink才能让AI通过，详见Playground的案例
4. 电梯门在正式游戏中会有相应的演出功能，在白膜中暂时只是普通门
5. 门的可交互空间是面前1米，高度不限，宽度约等于门洞宽度

**桥梁**

1. 桥梁在白模中用外部/内部地面+障碍物构成即可

**构成**

白模的详细构成，见此清单：[关卡设计](https://dikpa4hrtn9.feishu.cn/wiki/SBUQw11QGiUvvNkDo8OcqZNfnOe?from=from_copylink)

在游戏中，所有白模元素保存在如下位置：

![...](../../跃入迷城%20-%20数据库/关卡设计/images/关卡设定.002.png)

**正式模型**

[**劳旅 (Labor)**](../../跃入迷城 - GDD/故事/设定Wiki/阵营/民间组织/劳旅.md)

**Sector定义**

![...](../../跃入迷城%20-%20数据库/关卡设计/images/关卡设定.003.jpeg)

[**劳旅 (Labor)**](../../跃入迷城 - GDD/故事/设定Wiki/阵营/民间组织/劳旅.md)

|<p>![...](../../跃入迷城%20-%20数据库/关卡设计/images/关卡设定.004.png)</p><p>Sector 01</p>|<p>![...](../../跃入迷城%20-%20数据库/关卡设计/images/关卡设定.004.png)</p><p>Sector 02</p>|
| :-: | :-: |


|<p>![...](../../跃入迷城%20-%20数据库/关卡设计/images/关卡设定.004.png)</p><p>Sector 03</p>|<p>![...](../../跃入迷城%20-%20数据库/关卡设计/images/关卡设定.004.png)</p><p>Sector 04</p>|
| :-: | :-: |


|<p>![...](../../跃入迷城%20-%20数据库/关卡设计/images/关卡设定.004.png)</p><p>Sector 05</p>|<p>![...](../../跃入迷城%20-%20数据库/关卡设计/images/关卡设定.004.png)</p><p>Sector 06</p>|
| :-: | :-: |


|<p>![...](../../跃入迷城%20-%20数据库/关卡设计/images/关卡设定.004.png)</p><p>Sector 07</p>|<p>![...](../../跃入迷城%20-%20数据库/关卡设计/images/关卡设定.004.png)</p><p>Sector 08</p>|
| :-: | :-: |


|<p>![...](../../跃入迷城%20-%20数据库/关卡设计/images/关卡设定.005.png)</p><p>Sector 09</p>|<p>![...](../../跃入迷城%20-%20数据库/关卡设计/images/关卡设定.006.png)</p><p>Sector 10</p>|
| :-: | :-: |


